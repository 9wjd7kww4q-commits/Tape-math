<script>
let current = { ft:0, in:0, frac:0 };
let inputMode = 'IN';
let outputMode = 'IN';
let values = [];
let ops = [];

function updateEntry() {
  let parts = [];
  if (current.ft) parts.push(`${current.ft}'`);
  if (current.in || current.frac) {
    let f = current.frac ? ` ${current.frac}/16` : '';
    parts.push(`${current.in}${f}"`);
  }
  document.getElementById('entry').innerText = parts.join(' ') || '0';
  document.getElementById('mode').innerText =
    `Input: ${inputMode} | Output: ${outputMode}`;
}

function num(n) {
  if (inputMode === 'FT') current.ft = current.ft * 10 + n;
  else current.in = current.in * 10 + n;
  updateEntry();
}

function frac(f) {
  if (inputMode === 'IN') current.frac = f;
  updateEntry();
}

function setInput(m) {
  inputMode = m;
  updateEntry();
}

function toInches() {
  return current.ft * 12 + current.in + current.frac / 16;
}

function commit() {
  values.push(toInches());
  current = { ft:0, in:0, frac:0 };
  inputMode = 'IN';
}

function op(o) {
  commit();
  ops.push(o);
  updateEntry();
}

function equals() {
  commit();
  let total = values[0] || 0;

  for (let i = 0; i < ops.length; i++) {
    let n = values[i + 1];
    if (ops[i] === '+') total += n;
    if (ops[i] === '-') total -= n;
    if (ops[i] === '*') total *= n;
    if (ops[i] === '/') total /= n;
  }

  total = Math.round(total * 16) / 16;
  displayResult(total);
  values = [];
  ops = [];
}

function displayResult(val) {
  if (outputMode === 'IN') {
    let w = Math.floor(val);
    let f = Math.round((val - w) * 16);
    document.getElementById('result').innerText =
      f ? `${w} ${f}/16"` : `${w}"`;
  } else {
    let ft = Math.floor(val / 12);
    let rem = val - ft * 12;
    let w = Math.floor(rem);
    let f = Math.round((rem - w) * 16);
    document.getElementById('result').innerText =
      f ? `${ft}' ${w} ${f}/16"` : `${ft}' ${w}"`;
  }
}

function toggleOut() {
  outputMode = outputMode === 'IN' ? 'FT' : 'IN';
  updateEntry();
}

function clearAll() {
  current = { ft:0, in:0, frac:0 };
  values = [];
  ops = [];
  document.getElementById('entry').innerText = '0';
  document.getElementById('result').innerText = '0';
}
updateEntry();
</script>
